version: '3.8'
services:
  solr:
    image: "solr:8.11.2"
    container_name: solr-1
    entrypoint:
      - bash
      - "-c"
      - |
        # 直接以 root 用户创建目录和核心
        mkdir -p /var/solr/data
        /opt/docker-solr/scripts/precreate-core bioner-drugs
        /opt/docker-solr/scripts/precreate-core bioner-diseases
        /opt/docker-solr/scripts/precreate-core bioner-genetic
        /opt/docker-solr/scripts/precreate-core bioner-covid
        # 注意：这里直接运行，不切换用户
        exec solr-foreground
    ports:
      - "8983:8983"
    environment:
      - SOLR_HOME=/var/solr/data
    # 关键：不指定 user，让 entrypoint 处理
    # user: "solr:solr"  # 注释掉这行